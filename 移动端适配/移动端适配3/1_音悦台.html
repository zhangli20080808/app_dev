<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,user-scalable=no" />
<title>无标题文档</title>
<script>
setRem();
window.addEventListener("orientationchange", setRem);
window.addEventListener("resize", setRem);
function setRem() {
	var html = document.querySelector("html");
	var width = html.getBoundingClientRect().width;
	html.style.fontSize = width / 16 + "px";
}
</script>
<link href="css/index.css" rel="stylesheet" />
</head>
<body>
<section class="wrap">
	<header id="header">
		<div class="headerC">
			<h1 id="logo">
				<a href="#">
					<img src="img/logo.png">
				</a>
			</h1>
			<a href="javascript:;" id="menuBtn" class="menuBtnClos"></a>
			<nav id="btns">
				<a href="#" class="searchBtn">搜索</a>
				<a href="#">登陆</a>
				<a href="#">注册</a>
			</nav>
		</div>
		<form class="search">
			<input type="text" placeholder="请输入搜索内容">
			<input type="submit" value="搜索">
		</form>
		<ul id="nav">
			<li>
	            <a href="javascript:void(0);" class="" data-tab="index">首页</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="mv" class="">MV</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="pl" class="">悦单</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="vchart" class="">V榜</a>
	        </li>
		    <li><a href="http://zhongchou.yinyuetai.com/wap" class="">众筹</a></li>
	        <li>
	            <a href="http://www.yinyuetai.com/fanMass" data-tab="wapfan" class="">饭团</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="program" class="">节目</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="stage" class="">音悦stage</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="apps/mobile" class="">APP下载</a>
	        </li>
	        <li>
	            <a href="http://news.yinyuetai.com/" target="_blank" class="">资讯</a>
	        </li>
	        <li>
	            <a href="http://i.yinyuetai.com" target="_blank" class="selected">我的家</a>
	        </li>
	        <li>
	            <a href="javascript:void(0);" data-tab="apps" class="">热门应用</a>
	        </li>
		</ul>
	</header>
	<div class="content">
		<nav id="navScroll">
			<ul id="navs">
				<li class="active">
		            <a href="javascript:void(0);" class="" data-tab="index">首页</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="mv" class="">MV</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="pl" class="">悦单</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="vchart" class="">V榜</a>
		        </li>
			    <li><a href="http://zhongchou.yinyuetai.com/wap" class="">众筹</a></li>
		        <li>
		            <a href="http://www.yinyuetai.com/fanMass" data-tab="wapfan" class="">饭团</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="program" class="">节目</a>
		        </li><li>
		            <a href="javascript:void(0);" data-tab="program" class="">节目</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="stage" class="">音悦stage</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="apps/mobile" class="">APP下载</a>
		        </li>
		        <li>
		            <a href="http://news.yinyuetai.com/" target="_blank" class="">资讯</a>
		        </li>
		        <li>
		            <a href="http://i.yinyuetai.com" target="_blank" class="selected">我的家</a>
		        </li>
		        <li>
		            <a href="javascript:void(0);" data-tab="apps" class="">热门应用</a>
		        </li>
			</ul>
		</nav>
		<div id="picTab">
			<ul id="picList">
		    	<li>
		        	<a href="#">
		            	<img src="img/img1.jpg" />
		            </a>
		        </li>
		        <li>
		        	<a href="#">
		            	<img src="img/img2.jpg" />
		            </a>
		        </li>
		        <li>
		        	<a href="#">
		            	<img src="img/img3.jpg" />
		            </a>
		        </li>
		        <li>
		        	<a href="#">
		            	<img src="img/img4.jpg" />
		            </a>
		        </li>

		    </ul>
		    <nav id="picNav">
		    	<span class="active"></span>
		        <span></span>
		        <span></span>
		        <span></span>
		    </nav>
		</div>
		<section class="tab">
			<header class="tabHeader">
				<h2>MV首播</h2>
				<a href="#">更多</a>
			</header>
			<nav class="tabNav">
				<a href="javascript:;" class="J_area cur" data-area="all">全部</a>
				<a href="javascript:;" class="J_area" data-area="ml">内地</a>
				<a href="javascript:;" class="J_area" data-area="ht">港台</a>
				<a href="javascript:;" class="J_area" data-area="us">欧美</a>
				<a href="javascript:;" class="J_area" data-area="kr">韩国</a>
				<a href="javascript:;" class="J_area" data-area="jp">日本</a>
				<span></span>
			</nav>
			<section class="tabList">
				<ul class="tabNext">
					loading
				</ul>
				<ul class="tabShow">
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
					<li>
						<a href="#">
							<img src="img/img.jpg"/>
							<span>当我们混在一起 夏日泳池版</span>
						</a>
					</li>
				</ul>
				<ul class="tabNext">
					loading
				</ul>
			</section>
		</section>
	</div>
</section>
<script src="js/transform.js"></script>
<script>
document.addEventListener("touchstart",
	function(e) {
		e.preventDefault();
	}
);
navShow();
scrollPic();
navSwipe();
/*
search();
function search() {
	var wrap = document.querySelector(".wrap");
	var input = document.querySelector('input');
	wrap.onscroll = function() {
		input.value = 1;
	};
}
*/
function navShow() {
	var btn = document.querySelector("#menuBtn");
	var nav = document.querySelector("#nav");
	btn.addEventListener(
		"touchstart",
		function(e) {
			if(btn.className == "menuBtnClos") {
				btn.className = "menuBtnShow";
				nav.style.display = "block";
			} else {
				btn.className = "menuBtnClos";
				nav.style.display = "none";
			}
			e.stopPropagation();
		}
	);
	nav.addEventListener("touchstart", function(e) {
		e.stopPropagation();
	});
	document.addEventListener(
		"touchstart",
		function (){
			if(btn.className == "menuBtnShow"){
				btn.className = "menuBtnClos";
				nav.style.display = "none";
			}
		}
	);
}
tab();
function tab(){
	var tabList = document.querySelectorAll(".tabList");
	var tabNav = document.querySelectorAll(".tabNav");
	var width = tabNav[0].offsetWidth;
	for(var i = 0; i < tabNav.length; i++) {
		swipe(tabNav[i],tabList[i]);
	}
	function swipe(nav,list){
		cssTransform(list,"translateX",-width);
		var startPoint = 0;
		var startX = 0;
		var now = 0;
		var isMove = true;
		var isFirst = true;
		var next = document.querySelectorAll(".tabNext");
		var isLoad = false;
		var navA = nav.getElementsByTagName('a');
		var navActive = nav.getElementsByTagName('span')[0];
		list.addEventListener(
			"touchstart",
			function(e) {
				if(isLoad) {
					return;
				}
				list.style.transition = "none";
				startPoint = e.changedTouches[0];
				startX = cssTransform(list,"translateX");
				isMove = true;
				isFirst = true;
			}
		);
		list.addEventListener(
			"touchmove",
			function(e) {
				if(isLoad) {
					return;
				}
				if(!isMove) {
					return;
				}
				var nowPoint = e.changedTouches[0];
				var disX = nowPoint.pageX - startPoint.pageX;
				var disY = nowPoint.pageY - startPoint.pageY;
				if(isFirst) {
					isFirst = false;
					if(Math.abs(disY) > Math.abs(disX)) {
						isMove = false;
					}
				}
				if(isMove) {
					cssTransform(list,"translateX",startX + disX);
				}
				if(Math.abs(disX) > width/2){
					end(disX);
				}
			}
		);
		list.addEventListener(
			"touchend",
			function() {
				if(isLoad) {
					return ;
				}	
				list.style.transition = ".5s";
				cssTransform(list,"translateX",-width);
			}
		);
		function end(disX){
			isLoad = true;
			var dir = disX/Math.abs(disX); //正 右侧  负左侧
			var target = dir > 0? 0: -2*width;
			//console.log(dir);// -1 下一张   1 上一张
			now -= dir;
			//console.log(now);
			if(now < 0) {
				now = navA.length - 1;
			} 	
			if(now >= navA.length) {
				now = 0;
			}
			//console.log(now);
			list.style.transition = "300ms";
			cssTransform(list,"translateX",target);
			list.addEventListener(
				"webkitTransitionEnd",
				tranEnd
			);
			list.addEventListener(
				"transitionend",
				tranEnd
			);
		}
		function tranEnd(){
			var left = navA[now].offsetLeft;
			console.log(left);

			cssTransform(navActive,"translateX",left);
			list.removeEventListener(
				"webkitTransitionEnd",
				tranEnd
			);
			list.removeEventListener(
				"transitionend",
				tranEnd
			);
			for(var i = 0; i < next.length; i++){
				next[i].style.opacity = 1;
			}
			setTimeout(
				function(){ /* 在工作的时候，应该通过ajax 请求数据，然后修改 show里边内容，之后执行代码*/
					list.style.transition = "none";
					cssTransform(list,"translateX",-width);
					isLoad = false;
					for(var i = 0; i < next.length; i++){
						next[i].style.opacity = 0;
					}
				},1000
			)
		}
	}
}
function navSwipe() {
	var navScroll = document.querySelector('#navScroll');
	var navs = document.querySelector('#navs'); 
	var startPoint = 0;
	var startX = 0;
	var minX = navScroll.clientWidth - navs.offsetWidth;
	var step = 1;
	var lastX = 0; //上次的距离
	var lastTime = 0;//上次的时间戳
	var lastDis = 0;
	var lastTimeDis = 0;
	navScroll.addEventListener(
		'touchstart', 
		function(e) {
			navs.style.transition = "none";
			startPoint = e.changedTouches[0].pageX;
			startX = cssTransform(navs,"translateX");
			step = 1;
			lastX = startX;
			lastTime = new Date().getTime();
			lastDis = 0;
			lastTimeDis = 0;
		}
	);
	navScroll.addEventListener(
		'touchmove', 
		function(e) {
			var nowPoint = e.changedTouches[0].pageX;
			var dis = nowPoint - startPoint;
			var left = startX + dis;
			var nowTime = new Date().getTime();
			if(left > 0) {
				step = 1-left / navScroll.clientWidth; //根据超出长度计算系数大小，超出的越到 系数越小
				left = parseInt(left*step);
				/*left = 0;*/
			}
			if(left < minX) {
				var over = minX - left; // 计算下超出值
				step = 1-over / navScroll.clientWidth; //根据超出值计算系数
				over = parseInt(over*step);
				left = minX - over;
				/*left = minX; */
			}
			lastDis = left-lastX; //距离差值
			lastTimeDis = nowTime - lastTime; //时间差值
			lastX = left;
			lastTime = nowTime;
			cssTransform(navs,"translateX",left);
		}
	);
	navScroll.addEventListener(
		'touchend', 
		function (){
			var speed = (lastDis/lastTimeDis)*300; //用距离差值/时间差值 = 速度   速度*系数 = 缓冲距离
			var left = cssTransform(navs,"translateX");
			var target = left + speed; //当前值 + 缓冲距离 = 目标点
			var type = "cubic-bezier(.34,.92,.58,.9)";
			var time = Math.abs(speed*.9);
			time = time<300?300:time;
			if(target > 0) {
				target = 0;
				type ="cubic-bezier(.08,1.44,.6,1.46)";
			}
			if(target < minX) {
				target = minX;
				type ="cubic-bezier(.08,1.44,.6,1.46)";
			}
			navs.style.transition = time+"ms " + type;
			cssTransform(navs,"translateX",target);
		}
	);
}
/*
	缓冲快慢，和我移动的最后一次移动速度有关系
	速度快 缓冲距离就大
	速度慢 缓冲距离就小
	速度 =  距离 /时间
	
	距离 = 上次位置 和移动后位置的差值
	时间 = 上次时间 和 移动后时间的差值
	
*/
function scrollPic() {
	var wrap = document.querySelector("#picTab");
	var list = document.querySelector("#picList");
	list.innerHTML += list.innerHTML;
	var lis = document.querySelectorAll("#picList li");
	var css = document.createElement('style');
	var nav = document.querySelectorAll("#picNav span");
	var style = "#wrap{height:"+ lis[0].offsetHeight+"px}";
	var timer = 0;
	style+="#picList{width:"+lis.length+"00%}";
	style+="#picList li{width:"+(1/lis.length*100)+"%}"
	css.innerHTML+= style;
	document.head.appendChild(css);
	var startPoint = 0;
	var startX = 0;
	var now = 0;
	var isMove = true;
	var isFirst = true;
	cssTransform(list,"translateX",0);
	auto();
	wrap.addEventListener(
		"touchstart",
		function(e) {
			clearInterval(timer);
			list.style.transition = "none";
			var translateX = cssTransform(list,"translateX");
			now = Math.round(-translateX / wrap.offsetWidth);
			if(now == 0) {
				now = nav.length;
			}
			if(now == lis.length-1) {
				now = nav.length-1;
			}
			cssTransform(list,"translateX",-now * wrap.offsetWidth);
			startPoint = e.changedTouches[0];
			startX = cssTransform(list,"translateX");
			isMove = true;
			isFirst = true;
		}
	);
	wrap.addEventListener(
		"touchmove",
		function(e) {
			if(!isMove) {
				return;
			}
			var nowPoint = e.changedTouches[0];
			var disX = nowPoint.pageX - startPoint.pageX;
			var disY = nowPoint.pageY - startPoint.pageY;
			if(isFirst) {
				isFirst = false;
				if(Math.abs(disY) > Math.abs(disX)) {
					isMove = false;
				}
			}
			if(isMove) {
				cssTransform(list,"translateX",startX + disX);
			}
		}
	);
	wrap.addEventListener(
		"touchend",
		function(e) {
			var translateX = cssTransform(list,"translateX");
			now = Math.round(-translateX / wrap.offsetWidth);
			tab();
			auto();
		}
	);
	function auto() {
		clearInterval(timer);
		timer = setInterval(
			function() {
				if(now == lis.length-1) {
					now = nav.length-1;
				}
				list.style.transition = "none";
				cssTransform(list,"translateX",-now * wrap.offsetWidth);
				setTimeout(
					function () {
						now++;
						tab();	
					},30
				);
			},2000
		);
	}
	function tab() {
		list.style.transition = ".5s";
		cssTransform(list,"translateX",-now * wrap.offsetWidth);
		for(var i = 0 ; i < nav.length; i++) {
			nav[i].className = "";
		}
		nav[now%nav.length].className = "active";
	}
}
</script>
</body>
</html>		